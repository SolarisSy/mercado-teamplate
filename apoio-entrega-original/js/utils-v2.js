const Utils={checkUserLogin:async function(){return $.ajax({url:"/no-cache/profileSystem/getProfile",type:"GET"})},handleRegisterMissingDocument:async function(){let e=await Utils.checkUserLogin(),t=!1,o=!1;$("#register-doc-input-cpf, #register-doc-input-cnpj").focus((function(){$(".error-message")&&$(".error-message").remove(),$(".error-validation-message")&&$(".error-validation-message").remove()})),$("#register-doc-input-cpf").cpfcnpj({mask:!0,validate:"cpf",event:"focusout",handler:"#register-doc-input-cpf",ifValid:function(e){t=!0},ifInvalid:function(e){t=!1}}),$("#register-doc-input-cnpj").cpfcnpj({mask:!0,validate:"cnpj",event:"focusout",handler:"#register-doc-input-cnpj",ifValid:function(e){o=!0},ifInvalid:function(e){o=!1}}),$(".register-doc-btn").on("click",(function(){if($(".register-doc-btn").addClass("processing"),$("input#register-is-pj").is(":checked")){let n=$("#register-doc-input-cnpj").val(),i=$("#register-doc-input-cpf").val(),r="<p class='error-validation-message'>insira um documento válido</p>",c=document.querySelector(".input-doc-pj .error-validation-message"),a=document.querySelector(".input-doc-cpf .error-validation-message"),s="<p class='error-message'>este campo é obrigatório</p>",u=document.querySelector(".input-doc-pj .error-message"),l=document.querySelector(".input-doc-cpf .error-message");if(!n||!i)return!n&&i?(u||$(".input-doc-pj").append(s),t||a||$(".input-doc-cpf").append(r)):!i&&n?(l||$(".input-doc-cpf").append(s),o||c||$(".input-doc-pj").append(r)):n||i||u||l||($(".input-doc-pj").append(s),$(".input-doc-cpf").append(s)),void $(".register-doc-btn").removeClass("processing");if(n&&i)if(!o&&t){if(!c)return $(".input-doc-pj").append(r),void $(".register-doc-btn").removeClass("processing")}else if(!t&&o){if(!a)return $(".input-doc-cpf").append(r),void $(".register-doc-btn").removeClass("processing")}else if(!(o||t||c||a))return $(".input-doc-pj").append(r),$(".input-doc-cpf").append(r),void $(".register-doc-btn").removeClass("processing");Utils.checkDuplicatedMissingCpf(i,e)}else{let o=$("#register-doc-input-cpf").val();if(!o||""==o){if(!document.querySelector(".error-message")){let e="<p class='error-message'>este campo é obrigatório</p>";$(".input-doc-cpf").append(e)}return void $(".register-doc-btn").removeClass("processing")}if(!t){if(!document.querySelector(".error-validation-message")){let e="<p class='error-validation-message'>insira um documento válido</p>";$(".input-doc-cpf").append(e)}return void $(".register-doc-btn").removeClass("processing")}Utils.checkDuplicatedMissingCpf(o,e)}}))},checkDuplicatedMissingCpf:function(e,t){let o=null,n=null;$.when(Utils.checkMasterdataCPFs(e)).done((function(i){if(i&&i.length>=2)return o=i.length,void Utils.missingCpfValidation();$.when(Utils.checkMasterdataCPFs2(e)).done((function(i){if(i){if(i.length>=2)return void Utils.missingCpfValidation();if(n=i.length,o+n>=2)return void Utils.missingCpfValidation();Utils.allowCpfInput(e,t)}else Utils.allowCpfInput(e,t)}))}))},cpfValidation:function(e,t,o){try{var n=t?t.Email:"",i=!1;e.forEach((function(e){e.email==n&&(i=!0)})),0==i?(Utils.disableSaveButton(),document.querySelector("#cpfVerificationWarning")&&document.querySelector("#cpfVerificationWarning").remove(),$("<div id='cpfVerificationWarning' class='red f6 mt3 lh-title'>O limite de contas com esse CPF foi excedido.</div>").insertAfter(o.parentElement)):Utils.verificationAllowButton("cpf")}catch(e){console.error(e)}},checkMasterdataCPFs:function(e){if(e.length>=11)try{return $.ajax({async:!0,crossDomain:!0,type:"GET",method:"GET",url:"/api/dataentities/CL/search?_where=(document="+e.replace(/\D/g,"")+")&_fields=document,email&an=apoioentrega",headers:{Accept:"application/vnd.vtex.ds.v10+json","Content-Type":"application/json; charset=utf-8"}})}catch(e){console.error("Erro ao buscar dados",e)}},checkMasterdataCPFs2:function(e){if(e.length>=11)try{return $.ajax({async:!0,crossDomain:!0,type:"GET",method:"GET",url:"/api/dataentities/CL/search?_where=(document="+e+")&_fields=document,email&an=apoioentrega",headers:{Accept:"application/vnd.vtex.ds.v10+json","Content-Type":"application/json; charset=utf-8"}})}catch(e){console.error("Erro ao buscar dados",e)}},missingCpfValidation:function(){try{if(!document.querySelector(".error-message")){let e="<p class='error-message'>o limite de contas para este CPF foi excedido.</p>";$(".input-doc-cpf").append(e)}$(".register-doc-btn").removeClass("processing")}catch(e){console.error(e)}},allowCpfInput:function(e,t){let o=$("input#register-is-pj").is(":checked"),n=$("#register-doc-input-cnpj").val(),i={};i=o&&!1!==o?{userId:t.UserId,document:e,corporateDocument:n,isCorporate:o}:{userId:t.UserId,document:e},Utils.patchMissingDocumentOnMasterData(i).done((function(e){Utils.allocatePriceTableMissingDoc(t).done((function(){$(".register-doc-overlay").hide(),$(".register-doc-btn").removeClass("processing");Minicart.showAlert("","Documentação adicionada com sucesso!"),setTimeout((()=>{let e=window.location.href;window.location.href=e}),5e3)}))}))},patchMissingDocumentOnMasterData:function(e){let t="https://mauricio.supernosso.com.br/ApoioEntregasAdmCore/rest/ApoioEntrega/PatchDocument?";if(!e)return;let o="";o=e.corporateDocument?t+`UserId=${e.userId}&Document=${e.document}&CorporateDocument=${e.corporateDocument}&isCorporate=${e.isCorporate}`:t+`UserId=${e.userId}&Document=${e.document}`;try{return $.ajax({async:!0,crossDomain:!0,type:"GET",method:"GET",url:o,headers:{Accept:"application/vnd.vtex.ds.v10+json","Content-Type":"application/json; charset=utf-8"}})}catch(e){console.error(e)}},allocatePriceTableMissingDoc:function(e){if(!e||!e.IsUserDefined)return;let t=e.Email;try{return $.ajax({type:"GET",url:"https://mauricio.supernosso.com.br/ApoioEntregasAdmCore/rest/ApoioEntrega/AllocatePriceTable?Email="+t,success:function(e){console.log("allocate price table")},error:function(e){console.error(e)}})}catch(e){console.error("Erro ao buscar dados",e)}},cpfVerificationMyAccount:function(e){if("/_secure/account/"==window.location.pathname||"/_secure/account"==window.location.pathname){let t=setInterval((function(){if(document.querySelector(".section-my-account input[name='document']")){clearInterval(t);let o=document.querySelector(".section-my-account input[name='document']");o.addEventListener("focus",(function(){Utils.disableSaveButton(),Utils.preventEnterKeySubmit()})),o.addEventListener("blur",(function(){let t=null,n=null;o.value?(Utils.disableSaveButton(),$.when(Utils.checkMasterdataCPFs(o.value)).done((function(i){i&&i.length>=2?(t=i.length,Utils.cpfValidation(i,e,o)):$.when(Utils.checkMasterdataCPFs2(o.value)).done((function(i){if(i)if(i.length>=2)Utils.cpfValidation(i,e,o);else{n=i.length,t+n>=2?Utils.cpfValidation(i,e,o):Utils.verificationAllowButton("cpf")}else Utils.verificationAllowButton("cpf")}))}))):Utils.verificationAllowButton("cpf")}))}}),500)}},phoneNumberVerificationMyAccount:function(e){if("/_secure/account/"==window.location.pathname||"/_secure/account"==window.location.pathname)var t=setInterval((function(){if(document.querySelector(".section-my-account input[name='homePhone']")){clearInterval(t);var o=document.querySelector(".section-my-account input[name='homePhone']");o.addEventListener("focus",(function(){Utils.disableSaveButton(),Utils.preventEnterKeySubmit()})),o.addEventListener("blur",(function(){o.value?(Utils.disableSaveButton(),$.when(Utils.checkMasterdataPhoneNumber(o.value)).done((function(t){if(t&&t.length>=2)try{var n=e?e.Email:"",i=!1;t.forEach((function(e){e.email==n&&(i=!0)})),0==i?(Utils.disableSaveButton(),document.querySelector("#phoneNumberVerificationWarning")&&document.querySelector("#phoneNumberVerificationWarning").remove(),$("<div id='phoneNumberVerificationWarning' class='red f6 mt3 lh-title'>O limite de contas com esse telefone foi excedido.</div>").insertAfter(o.parentElement)):Utils.verificationAllowButton("phone")}catch(e){console.error(e)}else Utils.verificationAllowButton("phone")}))):Utils.verificationAllowButton("phone")}))}}),500)},checkMasterdataPhoneNumber:function(e){if(e.length>=8){let t="%2B55"+e.replace(/\D/g,"");return $.ajax({async:!0,crossDomain:!0,type:"GET",method:"GET",url:"/api/dataentities/CL/search?_where=(homePhone="+t+")&_fields=homePhone,email",headers:{Accept:"application/vnd.vtex.ds.v10+json","Content-Type":"application/json; charset=utf-8"}})}},disableSaveButton:function(){$(".account .vtex-account .vtex-profile-form__toggle-business-btn__wrapper + button").css("pointer-events","none"),$(".account .vtex-account .vtex-profile-form__toggle-business-btn__wrapper + button").css("background","#ddd")},verificationAllowButton:function(e){"cpf"==e?document.querySelector("#cpfVerificationWarning")?(document.querySelector("#cpfVerificationWarning").remove(),document.querySelector("#phoneNumberVerificationWarning")||($(".account .vtex-account .vtex-profile-form__toggle-business-btn__wrapper + button").css("pointer-events","auto"),$(".account .vtex-account .vtex-profile-form__toggle-business-btn__wrapper + button").css("background","#102F70"))):document.querySelector("#phoneNumberVerificationWarning")||($(".account .vtex-account .vtex-profile-form__toggle-business-btn__wrapper + button").css("pointer-events","auto"),$(".account .vtex-account .vtex-profile-form__toggle-business-btn__wrapper + button").css("background","#102F70")):"phone"==e&&(document.querySelector("#phoneNumberVerificationWarning")?(document.querySelector("#phoneNumberVerificationWarning").remove(),document.querySelector("#cpfVerificationWarning")||($(".account .vtex-account .vtex-profile-form__toggle-business-btn__wrapper + button").css("pointer-events","auto"),$(".account .vtex-account .vtex-profile-form__toggle-business-btn__wrapper + button").css("background","#102F70"))):document.querySelector("#cpfVerificationWarning")||($(".account .vtex-account .vtex-profile-form__toggle-business-btn__wrapper + button").css("pointer-events","auto"),$(".account .vtex-account .vtex-profile-form__toggle-business-btn__wrapper + button").css("background","#102F70")))},preventEnterKeySubmit:function(){$(window).keydown((function(e){if(13==e.keyCode)return e.preventDefault(),!1}))},allocatePriceTable:async function(e){if(e&&e.IsUserDefined)try{const t=`${"https://mauricio.supernosso.com.br/ApoioEntregasAdmCore/rest/ApoioEntrega"}/AllocatePriceTable?Email=${e.Email}`;return await fetch(t)}catch(e){console.error(e)}},checkUserDocumentOnMasterData:async function(e){if(!e||!e.IsUserDefined)return;const t=await Utils.getUserDocument(e.Email);Utils.launchModalMissingDocument(t,e)},getUserDocument:async function(e){try{const t=await fetch(`/api/dataentities/CL/search?_where=(email=${e})&_fields=document&an=apoioentrega`);return await t.json()}catch(e){console.error("get user document error",e)}},launchModalMissingDocument:function(e,t){if(!e||!t)return;if(!document.querySelector(".welcomeMsg"))if(t.FirstName){let e=`<p class="welcomeMsg">Olá, ${t.FirstName}!</p>`;$(".register-doc-overlay__title").prepend(e)}else{let e='<p class="welcomeMsg">Olá, visitante!</p>';$(".register-doc-overlay__title").prepend(e)}if(!e[0].document){$("#register-doc-input-cpf").mask("000.000.000-00",{reverse:!0}),$("#register-doc-input-cnpj").mask("00.000.000/0000-00",{reverse:!0}),$(".register-doc-overlay").show(),$(".register-doc-overlay__input-container-cpf").show(),$(".input-doc-pj input").prop("disabled",!0)}$("input#register-is-pj").click((function(){$("input#register-is-pj").is(":checked")?($(".input-doc-pj input").prop("disabled",!1),$(".input-doc-pj label").removeClass("input-disabled")):($(".input-doc-pj input").prop("disabled",!0),$(".input-doc-pj label").addClass("input-disabled"),$("#register-doc-input-cnpj").val(""))})),$("button.register-doc-overlay__close-icon, button.cancel-register").click((function(){$(".register-doc-overlay").hide()}))},fixPercentValue:function(e){const t=e.toFixed(2).toString();return Number(t.match(/\.(\d{2})/i)[1])<=50?Math.trunc(e):e.toFixed()},getUserHasNossoPayCard:function(e){if(!e||"string"!=typeof e)throw new Error("Invalid document");return fetch(`https://mauricio.supernosso.com.br/IntegraSnc_Core/rest/ClusterNossoPay/GetInfo?documento=${e}`)},getCupons:e=>{let t;return t=e?`https://mauricio.supernosso.com.br/ApoioEntregasAdmCore/rest/ApoioEntrega/GetCupons?empresa=AP&codigocupom=${e}`:"https://mauricio.supernosso.com.br/ApoioEntregasAdmCore/rest/ApoioEntrega/GetCupons?empresa=AP",fetch(t)}};
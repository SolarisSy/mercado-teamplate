const ShoppingList={checkLogin:async function(){return $.ajax({url:"/no-cache/profileSystem/getProfile",type:"GET"})},shoppingListService:async function(t,i){const s={GET:async function(t){return(await fetch(`/api/dataentities/LC/search?_fields=emailClient,items,id,title,sc&_where=emailClient=${t}&an=apoioentrega&v=2`)).json()},POST:async function(t){const{title:i,client:s,sc:n,items:e}=t;return(await fetch("/api/dataentities/LC/documents?_schema=LC",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:i,client:s,sc:n,items:e})})).json()},PUT:async function(t){const{title:i,client:s,sc:n,items:e,documentId:o}=t;return await fetch(`/api/dataentities/LC/documents/${o}?_schema=LC`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:i,client:s,sc:n,items:e})})},DELETE:async function(t){return await fetch(`https://mauricio.supernosso.com.br/ApoioEntregasAdmCore/rest/ApoioEntrega_DeleteDocumentId/deleteDoc?documentId=${t}`,{method:"DELETE",headers:{"Content-Type":"application/json"}})}};return s[t](i)},deleteSavedItemCart:function(t){const i=$(".shopping-list__trash");i.off("click.cleanList"),i.on("click.cleanList",(async function(){$(this).addClass("processing");const i=$(this).attr("data-id");if(i)try{200===(await ShoppingList.shoppingListService("DELETE",i)).status&&($(this).parent().replaceWith('<li class="shopping-list__item empty-list">\n              <input type="text" class="shopping-list__input" placeholder="Clique para salvar novo" data-empty-list="" readonly />\n              <div class="shopping-list__saveCancelActions">\n                <button class="shopping-list__cancel-button">Cancelar</button>\n                <button class="shopping-list__save-button" data-save-cart>Salvar</button>\n              </div>\n            </li>'),ShoppingList.showItemListActions(t),ShoppingList.addEventItemsList(t),ShoppingList.saveListByClick(t),ShoppingList.saveListByEnter(t),ShoppingList.deleteSavedItemCart(t),ShoppingList.applyItemsToMinicart(),Minicart.showAlert("A LISTA FOI APAGADA COM SUCESSO!","","",3e3)),$(this).removeClass("processing")}catch(t){$(this).removeClass("processing"),Minicart.showAlert("OPS, OCORREU UM ERRO AO APAGAR A LISTA!","","error",4e3)}}))},showShoppingLists:async function(t){const i=t.Email,s=await ShoppingList.shoppingListService("GET",i);ShoppingList.mountListsElementDesktop(s),ShoppingList.mountListsElementMobile(s)},mountListsElementDesktop:function(t){const i=$("#user-info").find(".auth-items-logged__shopping-list"),s=document.querySelector(".auth-items-logged__list"),n=document.createElement("ul");let e="";if(!i.length){for(let i=0;i<6;i++){const s=t[i];e+=ShoppingList.createList(s)}n.innerHTML=e,n.className="auth-items-logged__shopping-list",n.dataset.shoppingList="",$(n).insertAfter($(s))}},mountListsElementMobile:function(t){const i=$("#nav-wrapper-mob .shopping-list__lists"),s=document.querySelector("#nav-wrapper-mob .shopping-list__link"),n=document.createElement("ul");let e="";if(!i.length){for(let i=0;i<5;i++){const s=t[i];e+=ShoppingList.createList(s)}n.innerHTML=e,n.className="shopping-list__lists",n.dataset.shoppingList="",$(n).insertAfter($(s))}},createList:function(t){return void 0!==t&&void 0!==t.id?`<li class="shopping-list__item">\n            <input type="text" class="shopping-list__input" value="${t.title}" data-id="${t.id}" readonly>\n            <button data-id=${t.id} class="shopping-list__trash"></button>\n            <div class="shopping-list__saveCancelActions">\n              <button class="shopping-list__cancel-button">Cancelar</button>\n              <button class="shopping-list__save-button" data-save-cart>Salvar</button>\n            </div>\n            <textarea style="display: none">${JSON.stringify(t.items)}</textarea>\n            <p style="display: none">${t.sc}</p>\n            <ul class="shopping-list__actions">\n              <li data-open-cart>Abrir</li>\n              <li data-replace-cart>Substituir</li>\n            </ul>\n          </li>`:'<li class="shopping-list__item empty-list">\n          <input type="text" class="shopping-list__input" placeholder="Clique para salvar novo" data-empty-list readonly />\n          <div class="shopping-list__saveCancelActions">\n            <button class="shopping-list__cancel-button">Cancelar</button>\n            <button class="shopping-list__save-button" data-save-cart>Salvar</button>\n          </div>\n        </li>'},showListsLink:function(){let t,i;window.screen.width>766?(t=$(".auth-items-logged__shopping-list--link"),i=$(".auth-items-logged__shopping-list")):(t=$("#nav-wrapper-mob").find(".shopping-list__link"),i=$("#nav-wrapper-mob").find(".shopping-list")),t.on("click",(()=>{window.screen.width>766&&t.closest("li").toggleClass("active"),i.toggleClass("show-lists")}))},orderFormItemsToJson:function(t){return t.map((t=>({id:t.id,productId:t.productId,name:t.name,imageUrl:t.imageUrl,quantity:t.quantity,detailUrl:t.detailUrl,seller:t.seller})))},insertLiElement:function(){if($(".auth-items-logged__shopping-list--link").length)return;$('<li><a class="auth-items-logged__shopping-list--link" href="#0">\n                      <i></i><span>Meus carrinhos salvos</span>\n                    </a></li>').insertAfter($(".auth-items-logged__list li:nth-child(2)"))},triggerItemsActions:function(t,i){let s;if(!t.IsUserDefined)return sessionStorage.setItem("loginUserToSaveShoppingList",!0),document.location="/login";window.screen.width>766?(s=$("#user-info"),s.find(".auth-items-logged").addClass("active"),s.find(".auth-items-logged__shopping-list").addClass("show-lists"),$(".auth-items-logged__shopping-list--link").closest("li").addClass("active")):($("#nav-wrapper-mob").addClass("nav-opened"),$(".menu-header-mob").addClass("nav-opened"),$("body").addClass("overflow-hidden"),$(".shopping-list").addClass("show-lists"),$("#newMinicart").hasClass("active")&&Minicart.handleCloseMinicart()),ShoppingList.deleteSavedItemCart(t),ShoppingList.addEventItemsList(t)},minicartSaveButton:function(t){const i=$("[data-save-cart]");i.off("click.minicartSaveButton"),i.on("click.minicartSaveButton",(function(){ShoppingList.triggerItemsActions(t)}))},applyItemsToMinicart:function(){const t=$("[data-open-cart]"),i=$(".openList-confirmation-concat"),s=$(".openList-confirmation-replace");t.off("click.applyItemsToMinicart"),t.on("click.applyItemsToMinicart",(async t=>{const n=$(t.target).closest(".shopping-list__item");$(t.target).addClass("processing");const e=n.find("textarea").text(),o=n.find("p").text(),{items:a}=await vtexjs.checkout.getOrderForm();a.length>0?($(t.target).removeClass("processing"),$(".openList-confirmation-overlay").show(),$(".openList-confirmation-overlay__close-icon, .openList-confirmation-cancel").click((function(){$(".openList-confirmation-overlay").hide()})),s.off("click.replaceList"),s.on("click.replaceList",(function(t){$(t.target).addClass("processing"),ShoppingList.handleReplaceCartForList(e,o,n,t)})),i.off("click.concatList"),i.on("click.concatList",(function(t){$(t.target).addClass("processing"),ShoppingList.handleAddListToCart(e,o,n,t)}))):ShoppingList.handleAddListToCart(e,o,n,t)}))},handleAddListToCart:async function(t,i,s,n){try{if(await ShoppingList._addShoppingListToCart(t,i)){if($(n.target).removeClass("processing"),s.find(".shopping-list__actions").removeClass("show-actions"),!ShoppingList.minicartLocked())return;JSON.parse(t).map((t=>{Shelf.syncShelf(t.id,t.quantity)})),Minicart.showAlert("LISTA APLICADA AO CARRINHO","","",4e3),$(".openList-confirmation-overlay").hide()}}catch(t){console.log(t),$(n.target).removeClass("processing"),Minicart.showAlert("OPS, OCORREU UM ERRO AO APLICAR A LISTA!","","error",3e3),$(".openList-confirmation-overlay").hide()}},handleReplaceCartForList:function(t,i,s,n){Minicart.removeItemsFromCart().done((function(){ShoppingList.handleAddListToCart(t,i,s,n)}))},minicartLocked:function(){const t=$(".cart"),i=localStorage.getItem("unlockMinicart");return!(!i||"false"==i)||(t.addClass("active"),Minicart.handleMinicartPushContent(),$(".cart-backdrop").addClass("active"),!1)},_addShoppingListToCart:async function(t,i){const s=await JSON.parse(t).map((t=>({id:t.id,quantity:t.quantity,seller:t.seller})));return vtexjs.checkout.addToCart(s,null,i)},clickActionOnLists:function(t,i){const s=$(t.target),n=s.data(),e=i.find(".shopping-list__input"),o=i.find(".shopping-list__save-button"),a=i.find(".shopping-list__cancel-button"),p=i.find(".shopping-list__saveCancelActions"),l=s.closest(".shopping-list__item");let c=l.find(".shopping-list__save-button");const r=l.find(".shopping-list__cancel-button"),d=l.find(".shopping-list__saveCancelActions");if(void 0===n.openCart&&void 0===n.id&&void 0===n.saveCart){if(e.removeClass("shopping-list__input--available"),o.removeClass("shopping-list__save-button--available"),p.removeClass("shopping-list__saveCancelActions--available"),a.hide(),void 0!==n.replaceCart){const t=l.find(".shopping-list__input"),i=l.find(".shopping-list__trash");t.prop("readonly",!1).addClass("shopping-list__input--available").focus(),i.hide(),c.addClass("shopping-list__save-button--available"),d.addClass("shopping-list__saveCancelActions--available"),r.show(),ShoppingList.cancelSaveAction()}void 0!==n.emptyList&&(s.prop("readonly",!1).addClass("shopping-list__input--available").focus(),c.addClass("shopping-list__save-button--available"),d.addClass("shopping-list__saveCancelActions--available"),r.show(),ShoppingList.cancelSaveAction())}},cancelSaveAction:function(){$(".shopping-list__cancel-button").click((function(){ShoppingList.handleResetActions(this)}))},handleResetActions:function(t){let i=$(".shopping-list__item");if(t)i=$(t).parent().parent(),ShoppingList.resetActions(t,i);else for(var s=0;s<i.length;s++){let t=i[s];ShoppingList.resetActions("",t)}},resetActions:function(t,i){t||(t=".shopping-list__cancel-button"),$(i).hasClass("empty-list")?($(i).find(".shopping-list__input").val(""),$(t).hide()):($(i).find(".shopping-list__input").prop("readonly",!0),$(i).find(".shopping-list__trash").show()),$(i).find(".shopping-list__saveCancelActions").removeClass("shopping-list__saveCancelActions--available"),$(i).find(".shopping-list__input").removeClass("shopping-list__input--available"),$(i).find(".shopping-list__save-button").removeClass("shopping-list__save-button--available")},saveListByEnter:async function(t,i){const s=$(t.target),n="Enter"===t.key,e=$("[data-shopping-list]").find(".shopping-list__input[data-empty-list]");if(n){const t=$(s).parent().find(".shopping-list__save-button"),n=$(s).parent().find(".shopping-list__cancel-button");t.addClass("processing"),n.prop("disabled",!0);const o=(await vtexjs.checkout.getOrderForm()).items;if(0===o.length)return t.removeClass("processing"),n.prop("disabled",!1),void Minicart.showAlert("VOCÊ NÃO POSSUI ÍTENS NO CARRINHO","","",3e3);if(s.val().length<3)return Minicart.showAlert("O NOME DA LISTA DEVE CONTER PELO MENOS 3 CARACTERES"),t.removeClass("processing"),void n.prop("disabled",!1);let a=s.data("id");const p=s.val(),l=jssalesChannel,c=i.Email,r=ShoppingList.orderFormItemsToJson(o);if(void 0!==a)await ShoppingList.shoppingListService("PUT",{title:p,client:c,sc:l,items:r,documentId:a});else{a=(await ShoppingList.shoppingListService("POST",{title:p,client:c,sc:l,items:r})).DocumentId}ShoppingList.changeListDOM({input:s,title:p,client:c,sc:l,items:r,documentId:a}),t.removeClass("processing"),n.prop("disabled",!1),ShoppingList.applyItemsToMinicart(),e.prop("readonly",!1),Minicart.showAlert("CARRINHO SALVO COM SUCESSO!")}},saveListByClick:async function(t){const i=$("#user-info, #nav-wrapper-mob").find("[data-save-cart]"),s=$("[data-shopping-list]").find(".shopping-list__input[data-empty-list]");i.off("click.saveItemsByClick"),i.on("click.saveItemsByClick",(async i=>{const n=$(i.target).closest(".shopping-list__item"),e=n.find(".shopping-list__input"),o=$(n).find(".shopping-list__save-button"),a=$(n).find(".shopping-list__cancel-button");o.addClass("processing"),a.prop("disabled",!0);const p=(await vtexjs.checkout.getOrderForm()).items;if(0===p.length)return o.removeClass("processing"),a.prop("disabled",!1),void Minicart.showAlert("VOCÊ NÃO POSSUI ÍTENS NO CARRINHO","","",3e3);if(e.val().length<3)return Minicart.showAlert("O NOME DA LISTA DEVE CONTER PELO MENOS 3 CARACTERES"),o.removeClass("processing"),void a.prop("disabled",!1);let l=e.data("id");const c=e.val(),r=jssalesChannel,d=t.Email,h=ShoppingList.orderFormItemsToJson(p);if(void 0!==l)await ShoppingList.shoppingListService("PUT",{title:c,client:d,sc:r,items:h,documentId:l});else{l=(await ShoppingList.shoppingListService("POST",{title:c,client:d,sc:r,items:h})).DocumentId}ShoppingList.changeListDOM({input:e,title:c,client:d,sc:r,items:h,documentId:l}),o.removeClass("processing"),a.prop("disabled",!1),s.prop("readonly",!1),ShoppingList.applyItemsToMinicart(),Minicart.showAlert("CARRINHO SALVO COM SUCESSO!")}))},changeListDOM:async function(t){const i=await Utils.checkUserLogin(),s=t.documentId,{input:n,title:e,sc:o,items:a}=t,p=n.closest(".shopping-list__item"),l=ShoppingList.createList({title:e,id:s,items:a,sc:o});p.replaceWith($(l)),ShoppingList.showItemListActions(i),ShoppingList.addEventItemsList(i),ShoppingList.saveListByClick(i),ShoppingList.saveListByEnter(i),ShoppingList.deleteSavedItemCart(i),ShoppingList.applyItemsToMinicart()},addEventItemsList:async function(t){const i=$("[data-shopping-list]"),s=i.find(".shopping-list__item"),n=i.find(".shopping-list__input[data-empty-list]");s.off("click tap keyup.addEventItemsList"),n.prop("readonly",!1),ShoppingList.showItemListActions(t),s.on("click tap keyup.addEventItemsList",(i=>{"click"===i.type&&ShoppingList.clickActionOnLists(i,s),"keyup"===i.type&&ShoppingList.saveListByEnter(i,t)}))},userLoggedToSaveShoppingList:function(t){let i;t.IsUserDefined&&sessionStorage.getItem("loginUserToSaveShoppingList")&&(window.screen.width>766?(i=$("#user-info"),i.find(".auth-items-logged").addClass("active"),i.find(".auth-items-logged__shopping-list").addClass("show-lists"),i.find(".auth-items-logged__shopping-list--link").closest("li").addClass("active"),$(".cart.complete").addClass("active"),Minicart.verifyCEP(),Minicart.setDesktopBannerPosition(),Minicart.handleMinicartPushContent()):($("#nav-wrapper-mob").addClass("nav-opened"),$(".menu-header-mob").addClass("nav-opened"),$("body").addClass("overflow-hidden"),$(".shopping-list").addClass("show-lists"),$("#newMinicart").hasClass("active")&&Minicart.handleCloseMinicart()),sessionStorage.removeItem("loginUserToSaveShoppingList"),ShoppingList.addEventItemsList(t))},showItemListActions:function(t){$("#nav-wrapper-mob").find(".shopping-list").css("display","block");const i=$(".shopping-list__item");i.off("click"),i.on("click",(async function(s){s.target.className.includes("shopping-list__trash")||"Abrir"===s.target.textContent||($(this).find(".shopping-list__input").prop("readonly")?($(this).find(".shopping-list__actions").toggleClass("show-actions"),$(this).find(".shopping-list__actions").hasClass("show-actions")&&(i.not(this).find(".shopping-list__actions").removeClass("show-actions"),i.not(this).find(".shopping-list__saveCancelActions").removeClass("shopping-list__saveCancelActions--available"),i.not(this).find(".shopping-list__input").removeClass("shopping-list__input--available"),i.not(this).find(".shopping-list__cancel-button").hide(),i.not(this).find(".shopping-list__save-button").removeClass("shopping-list__save-button--available"))):($(this).find(".shopping-list__actions").removeClass("show-actions"),i.not(this).find(".shopping-list__actions").removeClass("show-actions")),ShoppingList.triggerItemsActions(t,s))}))},pageLoaded:async function(){const t=await ShoppingList.checkLogin();t.IsUserDefined&&(ShoppingList.insertLiElement(),await ShoppingList.showShoppingLists(t),ShoppingList.showListsLink(),ShoppingList.applyItemsToMinicart(),ShoppingList.saveListByClick(t),ShoppingList.showItemListActions(t),ShoppingList.deleteSavedItemCart(t)),ShoppingList.userLoggedToSaveShoppingList(t),ShoppingList.minicartSaveButton(t)}};$(window).load((()=>{ShoppingList.pageLoaded()}));